<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.solarnetwork.central.dras.dao.mybatis">

	<select id="NOW" resultType="org.joda.time.DateTime">
		SELECT CURRENT_TIMESTAMP
	</select>

	<sql id="fragment-LocationBoxFilter">
		<if test="filter.box == true">
			AND l.latitude BETWEEN #{filter.latitude} AND #{filter.boxLatitude}
			AND l.longitude BETWEEN #{filter.longitude} AND #{filter.boxLongitude}
		</if>
		<if test="filter.gxp != null">
			AND l.gxp = #{filter.gxp}
		</if>
		<if test="filter.icp != null">
			AND l.icp = #{filter.icp}
		</if>
		<if test="filter.postalCode != null">
			AND l.postal_code = #{filter.postalCode}
		</if>
		<if test="filter.region != null">
			AND l.region = #{filter.region}
		</if>
	</sql>

	<sql id="fragment-effective-date-where-lte">
		AND e.effective &lt;= 
		<choose>
			<when test="date != null">#{date,jdbcType=TIMESTAMP}</when>
			<otherwise>CURRENT_TIMESTAMP</otherwise>
		</choose>
	</sql>
	
</mapper>
